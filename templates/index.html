<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard EduDashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Preline CSS -->
<link href="https://cdn.jsdelivr.net/npm/preline/dist/preline.css" rel="stylesheet">

<!-- Preline JS -->
<script src="https://cdn.jsdelivr.net/npm/preline/dist/preline.js"></script>

</head>
<body class="bg-gray-100 font-sans">
    <!-- Navbar -->
    <!-- <nav class="bg-green-900 p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#" class="text-white text-2xl font-bold">EduDashboard</a>
            <div class="flex space-x-4">
                <a href="/" class="text-white hover:font-bold transition duration-300">Home</a>
                <a href="/dashboard" class="text-white hover:font-bold transition duration-300">Dashboard</a>
                <a href="/about" class="text-white hover:font-bold transition duration-300">About</a>
            </div>
        </div>
    </nav> -->
    <!-- ========== HEADER ========== -->
<header class="flex flex-wrap md:justify-start md:flex-nowrap z-50 w-full py-4">
    <nav class="relative max-w-7xl w-full flex flex-wrap md:grid md:grid-cols-12 basis-full items-center px-4 md:px-6 md:px-8 mx-auto">
    <div class="md:col-span-3">
        <!-- Logo -->
        <a class="flex-none rounded-xl text-xl inline-block font-bold text-gradient focus:outline-none focus:opacity-80" href="/" aria-label="EduDashboard">
            <div class="flex items-center gap-2">
                <!-- Icon -->
                <span class="text-indigo-500">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 20l9-5-9-5-9 5 9 5z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4l9 5-9 5-9-5 9-5z" />
                    </svg>
                </span>
                <!-- Logo Text -->
                <h1 class="text-2xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500">
                    EduDashboard
                </h1>
            </div>
        </a>
        
        <!-- End Logo -->
    </div>


    <!-- Collapse -->
    <div id="hs-navbar-hcail" class="hs-collapse hidden overflow-hidden transition-all duration-300 basis-full grow md:block md:w-auto md:basis-auto md:order-2 md:col-span-6" aria-labelledby="hs-navbar-hcail-collapse">
        <div class="flex flex-col gap-y-4 gap-x-0 mt-5 md:flex-row md:justify-center md:items-center md:gap-y-0 md:gap-x-7 md:mt-0">
        <div>
            <a class="inline-block text-black hover:text-gray-600 focus:outline-none focus:text-gray-600" href="/" aria-current="page">Home</a>
        </div>
        <div>
            <a class="relative inline-block text-black focus:outline-none before:absolute before:bottom-0.5 before:start-0 before:-z-[1] before:w-full before:h-1 before:bg-lime-400" href="/dashboard">Dashboard</a>
        </div>
        <div>
            <a class="inline-block text-black hover:text-gray-600 focus:outline-none focus:text-gray-600" href="/about">About</a>
        </div>
        </div>
    </div>
    <!-- End Collapse -->
    </nav>
</header>
<!-- ========== END HEADER ========== -->
    <!-- Main Content -->
    <div class="container mx-auto p-4">
        <div class="flex flex-col items-center justify-center w-full space-y-4 p-4">
            <!-- Dropzone dan File Upload -->
            <label for="fileInput" class="flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                    <svg class="w-8 h-8 mb-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                    </svg>
                    <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                    <p class="text-xs text-gray-500">CSV file only (MAX. 5MB)</p>
                </div>
                <input type="file" id="fileInput" accept=".csv" class="hidden">
            </label>
    
            <!-- Loading Indicator -->
            <div class="loading hidden text-gray-600 mt-4" id="loadingIndicator">
                Memproses data...
            </div>
        </div>
    
        <!-- Statistik -->
        <div id="statsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6 hidden">
            <div class="stat-card bg-white p-6 rounded-lg shadow text-center">
                <div class="stat-value text-2xl font-bold text-gray-800" id="totalSiswa">-</div>
                <div class="stat-label text-gray-500 mt-2">Total Siswa</div>
            </div>
            <div class="stat-card bg-white p-6 rounded-lg shadow text-center">
                <div class="stat-value text-2xl font-bold text-gray-800" id="totalProvinsi">-</div>
                <div class="stat-label text-gray-500 mt-2">Total Provinsi</div>
            </div>
            <div class="stat-card bg-white p-6 rounded-lg shadow text-center">
                <div class="stat-value text-2xl font-bold text-gray-800" id="ratioGender">-</div>
                <div class="stat-label text-gray-500 mt-2">Rasio Gender (L:P)</div>
            </div>
            <div class="stat-card bg-white p-6 rounded-lg shadow text-center">
                <div class="stat-value text-2xl font-bold text-gray-800" id="sdParticipation">-</div>
                <div class="stat-label text-gray-500 mt-2">Partisipasi SD</div>
            </div>
            <div class="stat-card bg-white p-6 rounded-lg shadow text-center">
                <div class="stat-value text-2xl font-bold text-gray-800" id="avgStudentsProvince">-</div>
                <div class="stat-label text-gray-500 mt-2">Rata-rata Siswa per Provinsi</div>
            </div>
        </div>
    
        <!-- Grafik -->
        <div class="charts-grid grid grid-cols-1 lg:grid-cols-2 gap-4 hidden" id="chartsGrid">
            <div class="chart-container bg-white p-6 rounded-lg shadow">
                <div id="mapChart"></div>
            </div>
            <div class="chart-container bg-white p-6 rounded-lg shadow">
                <div id="top10Chart"></div>
            </div>
            <div class="chart-container bg-white p-6 rounded-lg shadow">
                <div id="eduDistChart"></div>
            </div>
            <div class="chart-container bg-white p-6 rounded-lg shadow">
                <div id="genderChart"></div>
            </div>
            <div class="chart-container bg-white p-6 rounded-lg shadow">
                <div id="eduGenderChart"></div>
            </div>
            <div class="chart-container bg-white p-6 rounded-lg shadow">
                <div id="trendsChart"></div>
            </div>
            <div class="chart-container bg-white p-6 rounded-lg shadow">
                <div id="genderRatioChart"></div>
            </div>
            <div class="chart-container bg-white p-6 rounded-lg shadow">
                <div id="instDistChart"></div>
            </div>
            <div class="chart-container bg-white p-6 rounded-lg shadow">
                <div id="clustersChart"></div>
            </div>
        </div>
    </div>
    
<!-- ========== FOOTER ========== -->
<footer class="mt-auto w-full max-w-[85rem] py-10 px-4 sm:px-6 lg:px-8 mx-auto">
    <!-- Grid -->
    <div class="text-center">
      <div>
        <a class="flex-none text-xl font-semibold text-black" href="#" aria-label="Brand">EduDashboard</a>
      </div>
      <!-- End Col -->
  
      <div class="mt-3">
        <p class="text-gray-500">
          Â©2024 EduDashboard.
        </p>
      </div>
  
      <!-- Social Brands -->
      <div class="mt-3 space-x-2">
        <a class="size-8 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-full border border-transparent text-gray-500 hover:bg-gray-50 focus:outline-none focus:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none" href="#">
          <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M15.545 6.558a9.42 9.42 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.689 7.689 0 0 1 5.352 2.082l-2.284 2.284A4.347 4.347 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.304a4.792 4.792 0 0 0 0 3.063h.003c.635 1.893 2.405 3.301 4.492 3.301 1.078 0 2.004-.276 2.722-.764h-.003a3.702 3.702 0 0 0 1.599-2.431H8v-3.08h7.545z"/>
          </svg>
        </a>
        <a class="size-8 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-full border border-transparent text-gray-500 hover:bg-gray-50 focus:outline-none focus:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none" href="#">
          <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"/>
          </svg>
        </a>
        <a class="size-8 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-full border border-transparent text-gray-500 hover:bg-gray-50 focus:outline-none focus:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none" href="#">
          <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
          </svg>
        </a>
        <a class="size-8 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-full border border-transparent text-gray-500 hover:bg-gray-50 focus:outline-none focus:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none" href="#">
          <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M3.362 10.11c0 .926-.756 1.681-1.681 1.681S0 11.036 0 10.111C0 9.186.756 8.43 1.68 8.43h1.682v1.68zm.846 0c0-.924.756-1.68 1.681-1.68s1.681.756 1.681 1.68v4.21c0 .924-.756 1.68-1.68 1.68a1.685 1.685 0 0 1-1.682-1.68v-4.21zM5.89 3.362c-.926 0-1.682-.756-1.682-1.681S4.964 0 5.89 0s1.68.756 1.68 1.68v1.682H5.89zm0 .846c.924 0 1.68.756 1.68 1.681S6.814 7.57 5.89 7.57H1.68C.757 7.57 0 6.814 0 5.89c0-.926.756-1.682 1.68-1.682h4.21zm6.749 1.682c0-.926.755-1.682 1.68-1.682.925 0 1.681.756 1.681 1.681s-.756 1.681-1.68 1.681h-1.681V5.89zm-.848 0c0 .924-.755 1.68-1.68 1.68A1.685 1.685 0 0 1 8.43 5.89V1.68C8.43.757 9.186 0 10.11 0c.926 0 1.681.756 1.681 1.68v4.21zm-1.681 6.748c.926 0 1.682.756 1.682 1.681S11.036 16 10.11 16s-1.681-.756-1.681-1.68v-1.682h1.68zm0-.847c-.924 0-1.68-.755-1.68-1.68 0-.925.756-1.681 1.68-1.681h4.21c.924 0 1.68.756 1.68 1.68 0 .926-.756 1.681-1.68 1.681h-4.21z"/>
          </svg>
        </a>
      </div>
      <!-- End Social Brands -->
    </div>
    <!-- End Grid -->
  </footer>
  <!-- ========== END FOOTER ========== -->
    <script>
document.getElementById('fileInput').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (file) {
        const formData = new FormData();
        formData.append('file', file);

        document.getElementById('loadingIndicator').classList.remove('hidden');

        fetch('/process', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Tampilkan statistik dan grafik
                document.getElementById('statsContainer').classList.remove('hidden');
                document.getElementById('chartsGrid').classList.remove('hidden');

                // Isi data statistik
                document.getElementById('totalSiswa').textContent = data.stats.total_siswa;
                document.getElementById('totalProvinsi').textContent = data.stats.total_provinsi;
                document.getElementById('ratioGender').textContent = data.stats.ratio_gender;
                document.getElementById('sdParticipation').textContent = data.stats.sd_participation;
                document.getElementById('avgStudentsProvince').textContent = data.stats.avg_students_province;

                // Render grafik menggunakan Plotly
                Plotly.newPlot('mapChart', JSON.parse(data.plots.map));
                Plotly.newPlot('top10Chart', JSON.parse(data.plots.top10));
                Plotly.newPlot('eduDistChart', JSON.parse(data.plots.edu_dist));
                Plotly.newPlot('genderChart', JSON.parse(data.plots.gender));
                Plotly.newPlot('eduGenderChart', JSON.parse(data.plots.edu_gender));
                Plotly.newPlot('trendsChart', JSON.parse(data.plots.trends));
                Plotly.newPlot('genderRatioChart', JSON.parse(data.plots.gender_ratio));
                Plotly.newPlot('instDistChart', JSON.parse(data.plots.inst_dist));
                Plotly.newPlot('clustersChart', JSON.parse(data.plots.clusters));
            } else {
                alert('Error: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Terjadi kesalahan saat memproses file');
        })
        .finally(() => {
            document.getElementById('loadingIndicator').classList.add('hidden');
        });
    }
});

window.addEventListener('resize', function () {
    const charts = [
        'mapChart', 'top10Chart', 'eduDistChart', 'genderChart',
        'eduGenderChart', 'trendsChart', 'genderRatioChart', 'instDistChart', 'clustersChart'
    ];

    charts.forEach(chartId => {
        Plotly.relayout(chartId, {
            'xaxis.autorange': true,
            'yaxis.autorange': true
        });
    });
});

    </script>

</body>
</html>